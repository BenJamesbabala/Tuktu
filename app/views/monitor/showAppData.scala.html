@(appProps: tuktu.api.AppMonitorObject)
@import tuktu.api.{ DataPacket, BeginType, EndType }
@import play.api.libs.json.Json
@import tuktu.api.utils.anyMapToJson

@if(appProps.flowDataPacketCount.nonEmpty) {
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Branch</th>
                <th title="DataPackets (Datums)">Sent</th>
                <th title="DataPackets (Datums)">Completed</th>
            </tr>
        </thead>
        <tbody>
            @for(branch <- appProps.flowDataPacketCount.keys.toSeq.distinct.sorted) {
                <tr>
                    <td>@branch</td>
                    <td title="@appProps.flowDataPacketCount(branch).getOrElse(BeginType, 0) DataPackets containing a total of  @appProps.flowDatumCount(branch).getOrElse(BeginType, 0) Datums">
                        @appProps.flowDataPacketCount(branch).getOrElse(BeginType, 0) (@appProps.flowDatumCount(branch).getOrElse(BeginType, 0))
                    </td>
                    <td title="@appProps.flowDataPacketCount(branch).getOrElse(EndType, 0) DataPackets containing a total of  @appProps.flowDatumCount(branch).getOrElse(EndType, 0) Datums">
                        @appProps.flowDataPacketCount(branch).getOrElse(EndType, 0) (@appProps.flowDatumCount(branch).getOrElse(EndType, 0))
                    </td>
                </tr>
            }
        </tbody>
    </table>
} else {
    No data flow has been monitored yet.
}
@if(appProps.processorDataPacketCount.nonEmpty) {
    <table class="table table-striped">
        <thead>
            <tr>
                <th width="30%">Processor ID</th>
                <th width="35%">Received</th>
                <th width="35%">Completed</th>
            </tr>
        </thead>
        <tbody>
            @for((id, uuid) <- appProps.processorDataPacketCount.keys.toSeq.sorted.zip(appProps.processorDataPacketCount.map(x => java.util.UUID.randomUUID.toString))) {
                <tr>
                    <td>
                        <button class="btn btn-primary btn-sm" type="button" data-toggle="collapse" data-target=".lastDP_@{id}_@{uuid}" aria-expanded="false" aria-controls="collapseExample">
                            @id
                        </button>
                    </td>
                    <td title="@appProps.processorDataPacketCount(id).getOrElse(BeginType, 0) DataPackets containing a total of @appProps.processorDatumCount(id).getOrElse(BeginType, 0) Datums">
                        @appProps.processorDataPacketCount(id).getOrElse(BeginType, 0) (@appProps.processorDatumCount(id).getOrElse(BeginType, 0))
                    </td>
                    <td title="@appProps.processorDataPacketCount(id).getOrElse(EndType, 0) DataPackets containing a total of @appProps.processorDatumCount(id).getOrElse(EndType, 0) Datums">
                        @appProps.processorDataPacketCount(id).getOrElse(EndType, 0) (@appProps.processorDatumCount(id).getOrElse(EndType, 0))
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="collapse lastDP_@{id}_@{uuid}">
                            @if(appProps.processorDurations.getOrElse(id, Nil).nonEmpty) {
                                Min: @{appProps.processorDurations(id).min / 1000.0} s <br>
                                Max: @{appProps.processorDurations(id).max / 1000.0} s <br>
                                Avg: @{appProps.processorDurations(id).sum / 1000.0 / appProps.processorDurations(id).size} s <br>
                                Med: @{appProps.processorDurations(id).sorted.apply(appProps.processorDurations(id).size / 2) / 1000.0} s
                            }
                        </div>
                    </td>
                    <td>
                        <div class="collapse lastDP_@{id}_@{uuid}" style="white-space: pre-wrap;">@Json.prettyPrint(Json.toJson(appProps.processorDataPackets.get(id).map(map => map.getOrElse(BeginType, new DataPacket(Nil)).data.map(datum => anyMapToJson(datum))).getOrElse(Nil)))</div>
                    </td>
                    <td>
                        <div class="collapse lastDP_@{id}_@{uuid}" style="white-space: pre-wrap;">@Json.prettyPrint(Json.toJson(appProps.processorDataPackets.get(id).map(map => map.getOrElse(EndType, new DataPacket(Nil)).data.map(datum => anyMapToJson(datum))).getOrElse(Nil)))</div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}